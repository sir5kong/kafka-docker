<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=prev href=..><link href=../external/ rel=next><link rel=icon href=../assets/images/favicon.png><meta name=generator content="mkdocs-1.4.2, mkdocs-material-9.0.6"><title>Helm - Install Apache Kafka with Docker or Helm</title><link rel=stylesheet href=../assets/stylesheets/main.558e4712.min.css><link rel=stylesheet href=../assets/stylesheets/palette.2505c338.min.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-0YV8J6KF4D"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-0YV8J6KF4D",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-0YV8J6KF4D",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary data-md-color-accent> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#kafka-helm-chart class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=.. title="Install Apache Kafka with Docker or Helm" class="md-header__button md-logo" aria-label="Install Apache Kafka with Docker or Helm" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Install Apache Kafka with Docker or Helm </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Helm </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=查找> <button type=reset class="md-search__icon md-icon" title=清空当前内容 aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/sir5kong/kafka-docker title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> sir5kong/kafka-docker </div> </a> </div> </nav> <nav class=md-tabs aria-label=标签 data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=.. class=md-tabs__link> Docker Image </a> </li> <li class=md-tabs__item> <a href=./ class="md-tabs__link md-tabs__link--active"> Helm </a> </li> <li class=md-tabs__item> <a href=../external/ class=md-tabs__link> External Network </a> </li> <li class=md-tabs__item> <a href=../kraft/ class=md-tabs__link> About KRaft </a> </li> <li class=md-tabs__item> <a href=../README-zh/ class=md-tabs__link> 简体中文 </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="Install Apache Kafka with Docker or Helm" class="md-nav__button md-logo" aria-label="Install Apache Kafka with Docker or Helm" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> Install Apache Kafka with Docker or Helm </label> <div class=md-nav__source> <a href=https://github.com/sir5kong/kafka-docker title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> sir5kong/kafka-docker </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> Docker Image </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Helm <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Helm </a> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#prerequisites class=md-nav__link> Prerequisites </a> </li> <li class=md-nav__item> <a href=#get-repository-info class=md-nav__link> Get Repository Info </a> </li> <li class=md-nav__item> <a href=#deploy-kafka class=md-nav__link> Deploy Kafka </a> <nav class=md-nav aria-label="Deploy Kafka"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#deploy-a-single-node-cluster class=md-nav__link> Deploy a single-node cluster </a> </li> <li class=md-nav__item> <a href=#one-broker-and-one-controller-cluster class=md-nav__link> One broker and one controller cluster </a> </li> <li class=md-nav__item> <a href=#deploy-a-highly-available-cluster class=md-nav__link> Deploy a highly available cluster </a> </li> <li class=md-nav__item> <a href=#using-loadbalancer class=md-nav__link> Using LoadBalancer </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#combined-mode class=md-nav__link> combined mode </a> <nav class=md-nav aria-label="combined mode"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#chart-values class=md-nav__link> Chart Values </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#cluster-id class=md-nav__link> Cluster ID </a> </li> <li class=md-nav__item> <a href=#external-access class=md-nav__link> External Access </a> <nav class=md-nav aria-label="External Access"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#chart-values_1 class=md-nav__link> Chart Values </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../external/ class=md-nav__link> External Network </a> </li> <li class=md-nav__item> <a href=../kraft/ class=md-nav__link> About KRaft </a> </li> <li class=md-nav__item> <a href=../README-zh/ class=md-nav__link> 简体中文 </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#prerequisites class=md-nav__link> Prerequisites </a> </li> <li class=md-nav__item> <a href=#get-repository-info class=md-nav__link> Get Repository Info </a> </li> <li class=md-nav__item> <a href=#deploy-kafka class=md-nav__link> Deploy Kafka </a> <nav class=md-nav aria-label="Deploy Kafka"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#deploy-a-single-node-cluster class=md-nav__link> Deploy a single-node cluster </a> </li> <li class=md-nav__item> <a href=#one-broker-and-one-controller-cluster class=md-nav__link> One broker and one controller cluster </a> </li> <li class=md-nav__item> <a href=#deploy-a-highly-available-cluster class=md-nav__link> Deploy a highly available cluster </a> </li> <li class=md-nav__item> <a href=#using-loadbalancer class=md-nav__link> Using LoadBalancer </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#combined-mode class=md-nav__link> combined mode </a> <nav class=md-nav aria-label="combined mode"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#chart-values class=md-nav__link> Chart Values </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#cluster-id class=md-nav__link> Cluster ID </a> </li> <li class=md-nav__item> <a href=#external-access class=md-nav__link> External Access </a> <nav class=md-nav aria-label="External Access"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#chart-values_1 class=md-nav__link> Chart Values </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=kafka-helm-chart>Kafka helm chart<a class=headerlink href=#kafka-helm-chart title="Permanent link"> ¶</a></h1> <h2 id=prerequisites>Prerequisites<a class=headerlink href=#prerequisites title="Permanent link"> ¶</a></h2> <ul> <li>Kubernetes 1.18+</li> <li>Helm 3.3+</li> </ul> <h2 id=get-repository-info>Get Repository Info<a class=headerlink href=#get-repository-info title="Permanent link"> ¶</a></h2> <div class=highlight><pre><span></span><code>helm<span class=w> </span>repo<span class=w> </span>add<span class=w> </span>kafka-repo<span class=w> </span>https://helm-charts.itboon.top/kafka
helm<span class=w> </span>repo<span class=w> </span>update<span class=w> </span>kafka-repo
</code></pre></div> <h2 id=deploy-kafka>Deploy Kafka<a class=headerlink href=#deploy-kafka title="Permanent link"> ¶</a></h2> <h3 id=deploy-a-single-node-cluster>Deploy a single-node cluster<a class=headerlink href=#deploy-a-single-node-cluster title="Permanent link"> ¶</a></h3> <ul> <li>Turn off persistent storage here, only demonstrate the deployment operation</li> </ul> <div class=highlight><pre><span></span><code>helm<span class=w> </span>upgrade<span class=w> </span>--install<span class=w> </span>kafka<span class=w> </span><span class=se>\</span>
<span class=w>  </span>--namespace<span class=w> </span>kafka-demo<span class=w> </span><span class=se>\</span>
<span class=w>  </span>--create-namespace<span class=w> </span><span class=se>\</span>
<span class=w>  </span>--set<span class=w> </span>broker.combinedMode.enabled<span class=o>=</span><span class=s2>&quot;true&quot;</span><span class=w> </span><span class=se>\</span>
<span class=w>  </span>--set<span class=w> </span>broker.persistence.enabled<span class=o>=</span><span class=s2>&quot;false&quot;</span><span class=w> </span><span class=se>\</span>
<span class=w>  </span>kafka-repo/kafka
</code></pre></div> <h3 id=one-broker-and-one-controller-cluster>One broker and one controller cluster<a class=headerlink href=#one-broker-and-one-controller-cluster title="Permanent link"> ¶</a></h3> <div class=highlight><pre><span></span><code>helm<span class=w> </span>upgrade<span class=w> </span>--install<span class=w> </span>kafka<span class=w> </span><span class=se>\</span>
<span class=w>  </span>--namespace<span class=w> </span>kafka-demo<span class=w> </span><span class=se>\</span>
<span class=w>  </span>--create-namespace<span class=w> </span><span class=se>\</span>
<span class=w>  </span>--set<span class=w> </span>broker.persistence.size<span class=o>=</span><span class=s2>&quot;20Gi&quot;</span><span class=w> </span><span class=se>\</span>
<span class=w>  </span>kafka-repo/kafka
</code></pre></div> <blockquote> <p>Persistence storage is used by default.</p> </blockquote> <h3 id=deploy-a-highly-available-cluster>Deploy a highly available cluster<a class=headerlink href=#deploy-a-highly-available-cluster title="Permanent link"> ¶</a></h3> <div class=highlight><pre><span></span><code>helm<span class=w> </span>upgrade<span class=w> </span>--install<span class=w> </span>kafka<span class=w> </span><span class=se>\</span>
<span class=w>  </span>--namespace<span class=w> </span>kafka-demo<span class=w> </span><span class=se>\</span>
<span class=w>  </span>--create-namespace<span class=w> </span><span class=se>\</span>
<span class=w>  </span>--set<span class=w> </span>controller.replicaCount<span class=o>=</span><span class=s2>&quot;3&quot;</span><span class=w> </span><span class=se>\</span>
<span class=w>  </span>--set<span class=w> </span>broker.replicaCount<span class=o>=</span><span class=s2>&quot;3&quot;</span><span class=w> </span><span class=se>\</span>
<span class=w>  </span>--set<span class=w> </span>broker.heapOpts<span class=o>=</span><span class=s2>&quot;-Xms4096m -Xmx4096m&quot;</span><span class=w> </span><span class=se>\</span>
<span class=w>  </span>--set<span class=w> </span>broker.resources.requests.memory<span class=o>=</span><span class=s2>&quot;8Gi&quot;</span><span class=w> </span><span class=se>\</span>
<span class=w>  </span>--set<span class=w> </span>broker.resources.limits.memory<span class=o>=</span><span class=s2>&quot;16Gi&quot;</span><span class=w> </span><span class=se>\</span>
<span class=w>  </span>kafka-repo/kafka
</code></pre></div> <blockquote> <p>More values please refer to <a href=https://github.com/sir5kong/kafka-docker/raw/main/examples/values-production.yml>examples/values-production.yml</a></p> </blockquote> <h3 id=using-loadbalancer>Using LoadBalancer<a class=headerlink href=#using-loadbalancer title="Permanent link"> ¶</a></h3> <p>Enable Kubernetes external cluster access to Kafka brokers.</p> <div class=highlight><pre><span></span><code>helm<span class=w> </span>upgrade<span class=w> </span>--install<span class=w> </span>kafka<span class=w> </span><span class=se>\</span>
<span class=w>  </span>--namespace<span class=w> </span>kafka-demo<span class=w> </span><span class=se>\</span>
<span class=w>  </span>--create-namespace<span class=w> </span><span class=se>\</span>
<span class=w>  </span>--set<span class=w> </span>broker.external.enabled<span class=o>=</span><span class=s2>&quot;true&quot;</span><span class=w> </span><span class=se>\</span>
<span class=w>  </span>--set<span class=w> </span>broker.external.service.type<span class=o>=</span><span class=s2>&quot;LoadBalancer&quot;</span><span class=w> </span><span class=se>\</span>
<span class=w>  </span>--set<span class=w> </span>broker.external.domainSuffix<span class=o>=</span><span class=s2>&quot;kafka.example.com&quot;</span><span class=w> </span><span class=se>\</span>
<span class=w>  </span>kafka-repo/kafka
</code></pre></div> <p>Add domain name resolution to complete this deployment</p> <h2 id=combined-mode>combined mode<a class=headerlink href=#combined-mode title="Permanent link"> ¶</a></h2> <ul> <li>If process.roles is set to broker, the server acts as a broker.</li> <li>If process.roles is set to controller, the server acts as a controller.</li> <li>If process.roles is set to broker,controller, the server acts as both a broker and a controller.</li> </ul> <blockquote> <p>Kafka servers that act as both brokers and controllers are referred to as "combined" servers. Combined servers are simpler to operate for small use cases like a development environment. The key disadvantage is that the controller will be less isolated from the rest of the system. For example, it is not possible to roll or scale the controllers separately from the brokers in combined mode. Combined mode is not recommended in critical deployment environments.</p> </blockquote> <h3 id=chart-values>Chart Values<a class=headerlink href=#chart-values title="Permanent link"> ¶</a></h3> <table> <thead> <tr> <th>Key</th> <th>Type</th> <th>Default</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td>broker.combinedMode.enabled</td> <td>bool</td> <td><code>false</code></td> <td>Whether to enable the combined mode</td> </tr> </tbody> </table> <div class=highlight><pre><span></span><code><span class=nt>broker</span><span class=p>:</span>
<span class=w>  </span><span class=nt>combinedMode</span><span class=p>:</span>
<span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=w>  </span><span class=nt>replicaCount</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class=w>  </span><span class=nt>heapOpts</span><span class=p>:</span><span class=w> </span><span class=s>&quot;-Xms1024m</span><span class=nv> </span><span class=s>-Xmx1024m&quot;</span>
<span class=w>  </span><span class=nt>persistence</span><span class=p>:</span>
<span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=w>    </span><span class=nt>size</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">20Gi</span>
</code></pre></div> <h2 id=cluster-id>Cluster ID<a class=headerlink href=#cluster-id title="Permanent link"> ¶</a></h2> <p>In earlier versions, Kafka will automatically initialize the data directory, the current version needs to provide a <code>Cluster ID</code> and manually initialize the data directory:</p> <div class=highlight><pre><span></span><code><span class=nv>KAFKA_CLUSTER_ID</span><span class=o>=</span><span class=s2>&quot;</span><span class=k>$(</span>bin/kafka-storage.sh<span class=w> </span>random-uuid<span class=k>)</span><span class=s2>&quot;</span>
bin/kafka-storage.sh<span class=w> </span>format<span class=w> </span>-t<span class=w> </span><span class=nv>$KAFKA_CLUSTER_ID</span><span class=w> </span>-c<span class=w> </span>config/kraft/server.properties
</code></pre></div> <p>All nodes in a cluster need to use the same <code>Cluster ID</code>. In order to solve this problem, this project will automatically generate a <code>Cluster ID</code> and save it to <code>Secret</code> when it is deployed for the first time.</p> <h2 id=external-access>External Access<a class=headerlink href=#external-access title="Permanent link"> ¶</a></h2> <p>In order to connect to the Kafka server outside the cluster, each Broker must be exposed and <code>advertised.listeners</code> must be correctly configured.</p> <p>There are two ways to expose, <code>NodePort</code> and <code>LoadBalancer</code>, each broker node needs a <code>NodePort</code> or <code>LoadBalancer</code>.</p> <h3 id=chart-values_1>Chart Values<a class=headerlink href=#chart-values_1 title="Permanent link"> ¶</a></h3> <table> <thead> <tr> <th>Key</th> <th>Type</th> <th>Default</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td>broker.external.enabled</td> <td>bool</td> <td><code>false</code></td> <td>Whether to enable external access</td> </tr> <tr> <td>broker.external.service.type</td> <td>string</td> <td><code>NodePort</code></td> <td><code>NodePort</code> or <code>LoadBalancer</code></td> </tr> <tr> <td>broker.external.service.annotations</td> <td>object</td> <td><code>{}</code></td> <td>External serivce annotations</td> </tr> <tr> <td>broker.external.nodePorts</td> <td>list</td> <td><code>[]</code></td> <td>Provide at least one port number, if the count of ports is less than the count of broker nodes, it will be automatically incremented</td> </tr> <tr> <td>broker.external.domainSuffix</td> <td>string</td> <td><code>kafka.example.com</code></td> <td>If you use <code>LoadBalancer</code> for external access, you must use a domain name. The external domain name corresponding to the broker is <code>POD_NAME</code> + <code>domain name suffix</code>, such as <code>kafka-broker-0.kafka.example.com</code>. After the deployment, you need to complete the domain name resolution operation</td> </tr> </tbody> </table> <div class=highlight><pre><span></span><code><span class=c1>## NodePort example</span>
<span class=nt>broker</span><span class=p>:</span>
<span class=w>  </span><span class=nt>replicaCount</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class=w>  </span><span class=nt>external</span><span class=p>:</span>
<span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=w>    </span><span class=nt>service</span><span class=p>:</span>
<span class=w>      </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=s>&quot;NodePort&quot;</span>
<span class=w>      </span><span class=nt>annotations</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{}</span>
<span class=w>    </span><span class=nt>nodePorts</span><span class=p>:</span>
<span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">31050</span>
<span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">31051</span>
<span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">31052</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=c1>## LoadBalancer example</span>
<span class=nt>broker</span><span class=p>:</span>
<span class=w>  </span><span class=nt>replicaCount</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class=w>  </span><span class=nt>external</span><span class=p>:</span>
<span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=w>    </span><span class=nt>service</span><span class=p>:</span>
<span class=w>      </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=s>&quot;LoadBalancer&quot;</span>
<span class=w>      </span><span class=nt>annotations</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{}</span>
<span class=w>    </span><span class=nt>domainSuffix</span><span class=p>:</span><span class=w> </span><span class=s>&quot;kafka.example.com&quot;</span>
</code></pre></div> </article> </div> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": ["content.code.annotate", "content.code.copy", "navigation.tabs", "navigation.tabs.sticky", "navigation.instant", "navigation.sections"], "search": "../assets/javascripts/workers/search.e5c33ebb.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script> <script src=../assets/javascripts/bundle.51d95adb.min.js></script> </body> </html>